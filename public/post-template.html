<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calmiqs Blog Post</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#4FA49A",
              accent: "#FFD580",
              tech: "#5A67D8",
            },
            fontFamily: { sans: ["Poppins", "sans-serif"] },
          },
        },
      };
    </script>

    <link rel="stylesheet" href="/assets/css/style.css?v=12" />
  </head>

  <body class="font-sans bg-[#F9FAFB] text-gray-800">
    <!-- HEADER -->
    <div id="navbar-container"></div>

    <main class="max-w-4xl mx-auto py-16 px-6">
      <!-- Post Content -->
      <div id="postContainer" class="text-center"></div>

      <!-- Post Navigation -->
      <div id="postNav" class="flex justify-between mt-12"></div>

      <!-- Share Buttons -->
      <div class="mt-12 pt-8 border-t border-gray-200">
        <h3 class="text-lg font-semibold mb-4 text-center">Share this post</h3>
        <div class="flex justify-center gap-4">
          <a
            id="shareTwitter"
            target="_blank"
            class="share-btn bg-blue-400 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition"
          >
            üê¶ Twitter
          </a>
          <a
            id="shareLinkedIn"
            target="_blank"
            class="share-btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition"
          >
            üíº LinkedIn
          </a>
          <a
            id="shareFacebook"
            target="_blank"
            class="share-btn bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-lg transition"
          >
            üìò Facebook
          </a>
          <button
            id="copyLink"
            class="share-btn bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition"
          >
            üîó Copy Link
          </button>
        </div>
      </div>

      <!-- Comments Section -->
      <div id="commentsContainer" class="mt-16"></div>

      <!-- Back to Blog -->
      <div class="mt-12 text-center">
        <a
          href="blog.html"
          class="inline-block bg-primary text-white px-6 py-3 rounded-xl font-medium hover:bg-accent transition shadow"
        >
          ‚Üê Back to Blog
        </a>
      </div>
    </main>
    <!-- START: Calmiqs Newsletter Card -->
    <section aria-labelledby="newsletter-heading" class="max-w-3xl mx-auto my-8">
      <div
        class="bg-white rounded-xl shadow-lg p-6 md:p-8 flex flex-col md:flex-row items-center gap-6"
      >
        <div class="flex-1">
          <h3 id="newsletter-heading" class="text-xl font-semibold text-primary">
            Get calm updates ‚Äî join our newsletter
          </h3>
          <p class="mt-1 text-sm text-gray-600">
            Short, privacy-friendly updates. Unsubscribe anytime.
          </p>
        </div>

        <form
          id="calmiqs-newsletter-form"
          class="flex-1 w-full md:w-auto flex flex-col sm:flex-row gap-3 items-stretch"
          novalidate
        >
          <!-- visible inputs -->
          <div class="flex gap-2 w-full">
            <label for="n-email" class="sr-only">Email</label>
            <input
              id="n-email"
              name="email"
              type="email"
              required
              placeholder="you@domain.com"
              class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
              aria-describedby="n-email-error"
            />

            <label for="n-name" class="sr-only">Name</label>
            <input
              id="n-name"
              name="name"
              type="text"
              placeholder="Name (optional)"
              class="hidden sm:block w-36 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
            />
          </div>

          <!-- honeypot + timestamp (hidden) -->
          <input
            type="text"
            name="hp_addr"
            id="hp_addr"
            class="hidden"
            autocomplete="off"
            tabindex="-1"
          />
          <input type="hidden" name="ts" id="n-ts" />

          <div class="flex items-center gap-2 mt-2 sm:mt-0">
            <button
              id="n-submit"
              type="submit"
              class="bg-primary hover:bg-tech text-white px-4 py-2 rounded-lg shadow transition"
            >
              Subscribe
            </button>
          </div>
        </form>
      </div>

      <p id="n-email-error" class="mt-2 text-sm text-red-600 sr-only" role="alert"></p>
      <div
        id="n-success"
        class="mt-4 hidden bg-green-50 border border-green-200 text-green-800 rounded-lg px-4 py-3"
      >
        <strong>Thanks ‚Äî you‚Äôre subscribed!</strong>
        <p class="text-sm mt-1">
          By subscribing, you agree to receive occasional updates. Unsubscribe anytime.
        </p>
      </div>
    </section>
    <!-- END: Calmiqs Newsletter Card -->

    <footer class="bg-gray-100 py-8 mt-16 text-center text-gray-600">
      <p>¬© 2025 Calmiqs ‚Äì Wellness Meets Sustainability</p>
    </footer>

    <!-- Load Comments Script -->
    <script src="/assets/js/comments.js"></script>

    <script>
      (async () => {
        const postContainer = document.getElementById("postContainer");
        const postNav = document.getElementById("postNav");

        // Get post slug from URL
        const params = new URLSearchParams(window.location.search);
        const postSlug = params.get("post");

        if (!postSlug) {
          postContainer.innerHTML = `<p class="text-gray-500">Post not found.</p>`;
          return;
        }

        // Fallback embedded posts (same as before)
        const embeddedPosts = {
          "mindful-breathing": {
            title: "The Art of Mindful Breathing",
            date: "November 2, 2025",
            image: "https://via.placeholder.com/800x400?text=Mindful+Breathing",
            content: `
              <p>Mindful breathing allows you to focus on your breath and anchor your thoughts in the present moment. This practice reduces stress, anxiety, and improves focus.</p>
              <p class="mt-4">Start by taking deep, slow breaths, observing each inhale and exhale. Feel the air as it enters and leaves your body, grounding you in calm awareness.</p>
            `,
          },
          "eco-habits": {
            title: "5 Small Eco Habits That Reduce Stress",
            date: "November 4, 2025",
            image: "https://via.placeholder.com/800x400?text=Eco+Habits",
            content: `
              <p>Living sustainably doesn't have to be overwhelming. By making small eco-friendly changes, you can create a lifestyle that supports both the planet and your mental well-being.</p>
              <ul class="list-disc ml-6 mt-4 text-left">
                <li>Practice digital detoxes to save energy and reduce stress.</li>
                <li>Walk or cycle instead of driving short distances.</li>
                <li>Start composting to reconnect with nature.</li>
                <li>Use reusable water bottles and cups.</li>
                <li>Spend time in green spaces daily.</li>
              </ul>
            `,
          },
        };

        // Load posts from KV
        async function loadPosts() {
          try {
            const res = await fetch("/posts");
            if (!res.ok) throw new Error("KV fetch failed");
            return await res.json();
          } catch (err) {
            console.error("KV fetch failed, using fallback:", err);
            return embeddedPosts;
          }
        }

        const posts = await loadPosts();
        const keys = Object.keys(posts);
        const post = posts[postSlug];

        if (!post) {
          postContainer.innerHTML = `<p class="text-gray-500">Post not found.</p>`;
          return;
        }

        // Render post
        postContainer.innerHTML = `
          <h1 class="text-4xl font-bold text-primary mb-4">${post.title}</h1>
          <p class="text-gray-500 mb-6">${post.date}</p>
          <img src="${post.image}" alt="${
          post.imageAlt || post.title
        }" class="rounded-xl mb-8 shadow-lg mx-auto" />
          <div class="text-lg leading-relaxed text-left max-w-3xl mx-auto">${post.content}</div>
        `;

        // Setup share buttons
        const postUrl = window.location.href;
        const postTitle = encodeURIComponent(post.title);

        document.getElementById(
          "shareTwitter"
        ).href = `https://twitter.com/intent/tweet?text=${postTitle}&url=${encodeURIComponent(
          postUrl
        )}`;

        document.getElementById(
          "shareLinkedIn"
        ).href = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(
          postUrl
        )}`;

        document.getElementById(
          "shareFacebook"
        ).href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(postUrl)}`;

        document.getElementById("copyLink").addEventListener("click", async () => {
          try {
            await navigator.clipboard.writeText(postUrl);
            const btn = document.getElementById("copyLink");
            btn.textContent = "‚úÖ Copied!";
            setTimeout(() => (btn.textContent = "üîó Copy Link"), 2000);
          } catch (err) {
            alert("Failed to copy link");
          }
        });

        // Previous / Next navigation
        const currentIndex = keys.indexOf(postSlug);
        const prevKey = keys[currentIndex - 1];
        const nextKey = keys[currentIndex + 1];

        postNav.innerHTML = `
          <div>
            ${
              prevKey
                ? `<a href="post-template.html?post=${prevKey}" class="text-primary hover:underline">‚Üê ${posts[prevKey].title}</a>`
                : ""
            }
          </div>
          <div>
            ${
              nextKey
                ? `<a href="post-template.html?post=${nextKey}" class="text-primary hover:underline">${posts[nextKey].title} ‚Üí</a>`
                : ""
            }
          </div>
        `;

        // Initialize comments system
        window.initComments(postSlug);
      })();
    </script>
    <!-- Global scripts -->
    <script src="/assets/js/auth.js"></script>
    <script src="/assets/js/header-loader.js"></script>
    <!-- Load the comments script -->
    <script src="/assets/js/comments.js"></script>

    <!-- Comments container -->
    <div id="commentsContainer"></div>

    <!-- Initialize comments -->
    <script>
      const postSlug = "your-post-slug";
      window.initComments(postSlug);
    </script>
    <!-- Floating CTA (optional) -->
    <button
      id="calmiqs-floating-cta"
      aria-label="Subscribe"
      title="Subscribe"
      class="fixed right-6 bottom-6 bg-primary text-white p-3 rounded-full shadow-lg hidden md:block"
    >
      ‚úâÔ∏è
    </button>
  </body>
</html>
