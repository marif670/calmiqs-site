<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Calmiqs Admin Panel - Content Management & Newsletter Control"
    />
    <title>Calmiqs Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#4FA49A",
              accent: "#FFD580",
              tech: "#5A67D8",
            },
            fontFamily: { sans: ["Poppins", "sans-serif"] },
          },
        },
      };
    </script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
      }

      .fade-in {
        animation: fadeIn 0.3s ease-in;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }

      /* Editor Styles */
      .editor-toolbar {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
        padding: 0.75rem;
        background-color: #f3f4f6;
        border-radius: 0.5rem;
      }

      .editor-toolbar button {
        padding: 0.5rem 0.75rem;
        background-color: #ffffff;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        font-weight: 500;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .editor-toolbar button:hover {
        background-color: #f9fafb;
        border-color: #4fa49a;
        color: #4fa49a;
      }

      .editor-content {
        width: 100%;
        min-height: 24rem;
        padding: 1rem;
        border: 2px solid #d1d5db;
        border-radius: 0.5rem;
        font-family: "Poppins", sans-serif;
      }

      .editor-content:focus {
        outline: none;
        border-color: #4fa49a;
        box-shadow: 0 0 0 3px rgba(79, 164, 154, 0.1);
      }

      /* Form Styles */
      .field-group {
        margin-bottom: 1rem;
      }

      .field-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
      }

      .field-input {
        width: 100%;
        padding: 0.5rem 1rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        font-family: "Poppins", sans-serif;
        font-size: 0.875rem;
      }

      .field-input:focus {
        outline: none;
        border-color: #4fa49a;
        box-shadow: 0 0 0 3px rgba(79, 164, 154, 0.1);
      }

      /* Button Styles */
      .btn-primary {
        padding: 0.5rem 1rem;
        background-color: #4fa49a;
        color: white;
        border-radius: 0.5rem;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
      }

      .btn-primary:hover {
        opacity: 0.9;
        box-shadow: 0 4px 6px rgba(79, 164, 154, 0.2);
      }

      .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .btn-secondary {
        padding: 0.5rem 1rem;
        background-color: #d1d5db;
        color: #1f2937;
        border-radius: 0.5rem;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
      }

      .btn-secondary:hover {
        background-color: #9ca3af;
      }

      .btn-danger {
        padding: 0.5rem 1rem;
        background-color: #dc2626;
        color: white;
        border-radius: 0.5rem;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
      }

      .btn-danger:hover {
        background-color: #b91c1c;
      }

      /* Modal Styles */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 50;
      }

      .modal-card {
        background-color: white;
        border-radius: 0.75rem;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        max-width: 42rem;
        width: 100%;
        margin-left: 1rem;
        margin-right: 1rem;
      }

      .modal-hidden {
        display: none;
      }

      /* Status Badges */
      .status-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 500;
      }

      .status-success {
        background-color: #dcfce7;
        color: #166534;
      }

      .status-warning {
        background-color: #fef3c7;
        color: #92400e;
      }

      .status-error {
        background-color: #fee2e2;
        color: #991b1b;
      }

      /* Schema Preview */
      .schema-preview {
        background-color: #f3f4f6;
        padding: 0.75rem;
        border-radius: 0.5rem;
        font-family: "Courier New", monospace;
        font-size: 0.75rem;
        overflow: auto;
        max-height: 12rem;
        border: 1px solid #e5e7eb;
        white-space: pre-wrap;
        word-break: break-all;
      }

      /* Image Preview */
      .image-preview {
        position: relative;
        max-width: 100%;
        border-radius: 0.5rem;
        overflow: hidden;
        background: #f3f4f6;
      }

      .image-preview img {
        width: 100%;
        height: auto;
        display: block;
      }

      /* Loading state */
      .loading {
        opacity: 0.6;
        pointer-events: none;
      }

      .spinner {
        display: inline-block;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-900 font-sans">
    <!-- Auth Screen -->
    <div
      id="authScreen"
      class="min-h-screen flex items-center justify-center bg-gradient-to-br from-primary via-accent to-tech p-4"
    >
      <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
        <div class="text-center mb-8">
          <h1 class="text-3xl font-bold text-primary mb-2">Calmiqs Admin</h1>
          <p class="text-gray-600">Secure Content Management</p>
        </div>
        <form id="authForm" class="space-y-4">
          <div class="field-group">
            <label class="field-label">Password</label>
            <input
              type="password"
              id="authPassword"
              class="field-input"
              placeholder="Enter admin password"
              required
            />
          </div>
          <button type="submit" class="w-full btn-primary">Login</button>
          <p class="text-xs text-gray-500 text-center mt-4">üîí Password-protected access only</p>
        </form>
      </div>
    </div>

    <!-- Main Admin Panel -->
    <div id="adminPanel" class="hidden min-h-screen bg-gray-50">
      <!-- Header -->
      <header class="bg-white border-b border-gray-200 sticky top-0 z-40 shadow-sm">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
          <div class="flex items-center gap-4">
            <a href="/" class="flex items-center gap-2">
              <img src="/assets/logo.svg" alt="Calmiqs Logo" class="h-8 w-8" />
              <span class="text-2xl font-bold text-primary">Calmiqs</span>
            </a>
            <span class="status-badge status-success">üü¢ Connected</span>
          </div>
          <button id="logoutBtn" class="btn-secondary text-sm">Logout</button>
        </div>
      </header>

      <!-- Tabs Navigation -->
      <nav class="bg-white border-b border-gray-200 sticky top-16 z-30 shadow-sm">
        <div class="max-w-7xl mx-auto px-6 flex gap-4 overflow-x-auto">
          <button
            class="tab-btn py-4 px-4 border-b-2 border-primary text-primary font-medium hover:text-primary transition"
            data-tab="editor"
          >
            üìù Editor
          </button>
          <button
            class="tab-btn py-4 px-4 border-b-2 border-transparent text-gray-600 hover:text-gray-900 transition"
            data-tab="images"
          >
            üñºÔ∏è Images
          </button>
          <button
            class="tab-btn py-4 px-4 border-b-2 border-transparent text-gray-600 hover:text-gray-900 transition"
            data-tab="newsletter"
          >
            üìß Newsletter
          </button>
          <button
            class="tab-btn py-4 px-4 border-b-2 border-transparent text-gray-600 hover:text-gray-900 transition"
            data-tab="seo"
          >
            üîç SEO & Schema
          </button>
          <button
            class="tab-btn py-4 px-4 border-b-2 border-transparent text-gray-600 hover:text-gray-900 transition"
            data-tab="settings"
          >
            ‚öôÔ∏è Settings
          </button>
        </div>
      </nav>

      <!-- Content Area -->
      <main class="max-w-7xl mx-auto px-6 py-8">
        <!-- EDITOR TAB -->
        <div id="editor" class="tab-content active fade-in">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left: Editor -->
            <div class="lg:col-span-2 space-y-6">
              <!-- Post Management -->
              <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-xl font-bold text-primary mb-4">üìù Post Management</h2>
                <div class="grid grid-cols-2 gap-3 mb-6">
                  <button
                    id="newPostBtn"
                    class="btn-primary flex items-center justify-center gap-2 w-full"
                  >
                    <i class="fas fa-plus"></i>
                    New
                  </button>
                  <button
                    id="loadPostBtn"
                    class="btn-secondary flex items-center justify-center gap-2 w-full"
                  >
                    <i class="fas fa-folder-open"></i>
                    Load
                  </button>
                  <button
                    id="savePostBtn"
                    class="btn-primary flex items-center justify-center gap-2 w-full"
                  >
                    <i class="fas fa-save"></i>
                    Save
                  </button>
                  <button
                    id="deletePostBtn"
                    class="btn-danger flex items-center justify-center gap-2 w-full"
                  >
                    <i class="fas fa-trash"></i>
                    Delete
                  </button>
                </div>
                <div class="field-group">
                  <label class="field-label">Post Slug (auto-generated)</label>
                  <input type="text" id="postSlug" class="field-input" readonly />
                </div>
              </div>

              <!-- Hero Image Upload Section -->
              <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-lg font-bold text-primary mb-4">üñºÔ∏è Hero Image</h2>

                <div class="field-group">
                  <label class="field-label">Upload Hero Image</label>
                  <input type="file" id="heroImageFile" class="field-input" accept="image/*" />
                </div>

                <div class="field-group">
                  <label class="field-label">Image Alt Text</label>
                  <input
                    type="text"
                    id="heroAlt"
                    class="field-input"
                    placeholder="Describe the image for accessibility"
                  />
                </div>

                <div class="grid grid-cols-2 gap-3 mb-4">
                  <button id="uploadHeroBtn" type="button" class="btn btn-primary">
                    üì§ Upload to R2
                  </button>
                  <button id="selectHeroBtn" type="button" class="btn btn-secondary">
                    üñºÔ∏è From Library
                  </button>
                </div>

                <div
                  id="heroPreview"
                  class="rounded-lg overflow-hidden bg-gray-100 h-48 flex items-center justify-center"
                >
                  <span class="text-gray-400">No image selected</span>
                </div>
              </div>

              <script>
                // Hero image upload handler
                document.getElementById("uploadHeroBtn").addEventListener("click", async () => {
                  const fileInput = document.getElementById("heroImageFile");
                  const altInput = document.getElementById("heroAlt");

                  if (!fileInput.files[0]) {
                    alert("Please select an image file");
                    return;
                  }

                  const file = fileInput.files[0];
                  const formData = new FormData();
                  formData.append("file", file);
                  formData.append("alt", altInput.value || file.name);

                  const uploadBtn = document.getElementById("uploadHeroBtn");
                  uploadBtn.disabled = true;
                  uploadBtn.textContent = "üì§ Uploading...";

                  try {
                    const response = await fetch("/api/images/upload", {
                      method: "POST",
                      headers: {
                        "X-Admin-Token":
                          "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Hadia@2017_Ayesha@2007",
                      },
                      body: formData,
                    });

                    const data = await response.json();

                    if (response.ok) {
                      // Store the URL for later use
                      document.getElementById("postImage").value = data.url;
                      document.getElementById("heroPreview").innerHTML = `
        <img src="${data.url}" alt="${data.metadata.alt}" class="w-full h-full object-cover" />
      `;
                      alert("‚úÖ Hero image uploaded successfully!");
                      fileInput.value = "";
                    } else {
                      alert("‚ùå Upload failed: " + (data.error || "Unknown error"));
                    }
                  } catch (error) {
                    console.error("Upload error:", error);
                    alert("‚ùå Upload failed: " + error.message);
                  } finally {
                    uploadBtn.disabled = false;
                    uploadBtn.textContent = "üì§ Upload to R2";
                  }
                });
              </script>

              <!-- Post Content -->
              <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-lg font-bold text-primary mb-4">üìÑ Content Editor</h2>
                <div class="editor-toolbar">
                  <button type="button" data-cmd="bold" title="Bold (Ctrl+B)">
                    <i class="fas fa-bold"></i>
                  </button>
                  <button type="button" data-cmd="italic" title="Italic (Ctrl+I)">
                    <i class="fas fa-italic"></i>
                  </button>
                  <button type="button" data-cmd="underline" title="Underline (Ctrl+U)">
                    <i class="fas fa-underline"></i>
                  </button>
                  <div style="width: 1px; background: #d1d5db; margin: 0 0.5rem"></div>
                  <button type="button" data-cmd="h2" title="Heading 2">H2</button>
                  <button type="button" data-cmd="h3" title="Heading 3">H3</button>
                  <div style="width: 1px; background: #d1d5db; margin: 0 0.5rem"></div>
                  <button type="button" data-cmd="ul" title="Bullet List">
                    <i class="fas fa-list"></i>
                  </button>
                  <button type="button" data-cmd="ol" title="Numbered List">
                    <i class="fas fa-list-ol"></i>
                  </button>
                  <button type="button" data-cmd="link" title="Insert Link">
                    <i class="fas fa-link"></i>
                  </button>
                </div>
                <div
                  id="postContent"
                  class="editor-content"
                  contenteditable="true"
                  role="textbox"
                  aria-label="Post content editor"
                  placeholder="Write your post content here..."
                ></div>
              </div>

              <!-- Inline Images -->
              <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-lg font-bold text-primary mb-4">üñºÔ∏è Inline Images</h2>
                <div class="field-group">
                  <label class="field-label">Select Image</label>
                  <input type="file" id="inlineImageFile" class="field-input" accept="image/*" />
                </div>
                <div class="grid grid-cols-2 gap-3">
                  <button
                    id="uploadInlineBtn"
                    class="btn-primary flex items-center justify-center gap-2"
                  >
                    <i class="fas fa-cloud-upload-alt"></i>
                    Upload & Insert
                  </button>
                  <button
                    id="openLibraryBtn"
                    class="btn-secondary flex items-center justify-center gap-2"
                  >
                    <i class="fas fa-image"></i>
                    From Library
                  </button>
                </div>
              </div>
            </div>

            <!-- Right: Metadata -->
            <div class="space-y-6">
              <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-lg font-bold text-primary mb-4">üìã Post Metadata</h2>
                <div class="field-group">
                  <label class="field-label">Title *</label>
                  <input
                    type="text"
                    id="postTitle"
                    class="field-input"
                    placeholder="Post title"
                    required
                  />
                </div>
                <div class="field-group">
                  <label class="field-label">Excerpt</label>
                  <textarea
                    id="postExcerpt"
                    class="field-input"
                    rows="3"
                    placeholder="Brief summary"
                  ></textarea>
                </div>
                <div class="field-group">
                  <label class="field-label">Date</label>
                  <input type="date" id="postDate" class="field-input" />
                </div>
                <div class="field-group">
                  <label class="field-label">Category</label>
                  <select id="postCategory" class="field-input">
                    <option value="wellness">Wellness</option>
                    <option value="sustainability">Sustainability</option>
                    <option value="technology">Technology</option>
                    <option value="lifestyle">Lifestyle</option>
                  </select>
                </div>
                <div class="field-group">
                  <label class="field-label">Tags (comma-separated)</label>
                  <input
                    type="text"
                    id="postTags"
                    class="field-input"
                    placeholder="tag1, tag2, tag3"
                  />
                </div>
                <div class="field-group">
                  <label class="field-label">Author</label>
                  <input
                    type="text"
                    id="postAuthor"
                    class="field-input"
                    placeholder="Author name"
                  />
                </div>
                <div class="field-group">
                  <label class="field-label">Read Time</label>
                  <input
                    type="text"
                    id="postReadTime"
                    class="field-input"
                    placeholder="5 min read"
                  />
                </div>
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                  <input
                    type="checkbox"
                    id="autosaveToggle"
                    checked
                    class="w-4 h-4 accent-primary"
                  />
                  <span>Auto-save every 60s</span>
                </label>
              </div>

              <!-- Preview -->
              <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-lg font-bold text-primary mb-4">üëÅÔ∏è Preview</h2>
                <div
                  id="postPreview"
                  class="text-sm border border-gray-200 rounded-lg p-4 bg-gray-50 max-h-64 overflow-auto"
                ></div>
              </div>
            </div>
          </div>
        </div>

        <!-- IMAGES TAB -->
        <div id="images" class="tab-content fade-in">
          <div class="bg-white rounded-xl shadow p-6">
            <h2 class="text-2xl font-bold text-primary mb-6">üñºÔ∏è Image Library</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="imageLibraryGrid">
              <div class="col-span-full text-center py-8 text-gray-500">Loading images...</div>
            </div>
          </div>
        </div>

        <!-- NEWSLETTER TAB -->
        <div id="newsletter" class="tab-content fade-in">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-6">
              <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-2xl font-bold text-primary mb-6">üìß Newsletter Management</h2>

                <!-- Stats -->
                <div class="grid grid-cols-3 gap-4 mb-8">
                  <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <div class="text-2xl font-bold text-tech" id="totalSubscribers">0</div>
                    <div class="text-sm text-gray-600">Total Subscribers</div>
                  </div>
                  <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                    <div class="text-2xl font-bold text-green-600" id="activeSubscribers">0</div>
                    <div class="text-sm text-gray-600">Active</div>
                  </div>
                  <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                    <div class="text-2xl font-bold text-yellow-600" id="unsubscribed">0</div>
                    <div class="text-sm text-gray-600">Unsubscribed</div>
                  </div>
                </div>

                <!-- Send Newsletter -->
                <div class="border-t pt-6">
                  <h3 class="text-lg font-semibold mb-4">Send Newsletter</h3>
                  <div class="field-group">
                    <label class="field-label">Subject Line</label>
                    <input
                      type="text"
                      id="newsletterSubject"
                      class="field-input"
                      placeholder="Email subject"
                    />
                  </div>
                  <div class="field-group">
                    <label class="field-label">Email Content</label>
                    <textarea
                      id="newsletterContent"
                      class="field-input"
                      rows="6"
                      placeholder="HTML or plain text content"
                    ></textarea>
                  </div>
                  <button
                    id="sendNewsletterBtn"
                    class="btn-primary w-full flex items-center justify-center gap-2"
                  >
                    <i class="fas fa-paper-plane"></i>
                    Send to All Subscribers
                  </button>
                </div>

                <!-- Subscribers List -->
                <div class="border-t mt-6 pt-6">
                  <h3 class="text-lg font-semibold mb-4">Subscribers</h3>
                  <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                      <thead class="bg-gray-100">
                        <tr>
                          <th class="px-4 py-2 text-left">Email</th>
                          <th class="px-4 py-2 text-left">Status</th>
                          <th class="px-4 py-2 text-left">Subscribed</th>
                          <th class="px-4 py-2">Actions</th>
                        </tr>
                      </thead>
                      <tbody id="subscribersList" class="divide-y">
                        <tr>
                          <td colspan="4" class="px-4 py-8 text-center text-gray-500">
                            Loading subscribers...
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <div class="space-y-6">
              <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-lg font-bold text-primary mb-4">‚öôÔ∏è Settings</h2>
                <div class="field-group">
                  <label class="field-label">From Email</label>
                  <input
                    type="email"
                    id="fromEmail"
                    class="field-input"
                    placeholder="noreply@calmiqs.com"
                  />
                </div>
                <div class="field-group">
                  <label class="field-label">From Name</label>
                  <input
                    type="text"
                    id="fromName"
                    class="field-input"
                    placeholder="Calmiqs Newsletter"
                  />
                </div>
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                  <input
                    type="checkbox"
                    id="requireConfirm"
                    checked
                    class="w-4 h-4 accent-primary"
                  />
                  <span>Require double opt-in</span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- SEO & SCHEMA TAB -->
        <div id="seo" class="tab-content fade-in">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="space-y-6">
              <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-lg font-bold text-primary mb-4">üîç SEO Meta Tags</h2>
                <div class="field-group">
                  <label class="field-label">Meta Description</label>
                  <textarea
                    id="metaDescription"
                    class="field-input"
                    rows="2"
                    placeholder="160 characters recommended"
                    maxlength="160"
                  ></textarea>
                  <span class="text-xs text-gray-500 mt-1" id="metaDescCount">0/160</span>
                </div>
                <div class="field-group">
                  <label class="field-label">Meta Keywords</label>
                  <input
                    type="text"
                    id="metaKeywords"
                    class="field-input"
                    placeholder="keyword1, keyword2, keyword3"
                  />
                </div>
                <div class="field-group">
                  <label class="field-label">OG Image URL</label>
                  <input
                    type="text"
                    id="ogImage"
                    class="field-input"
                    placeholder="Open Graph image URL"
                  />
                </div>
                <div class="field-group">
                  <label class="field-label">Canonical URL</label>
                  <input
                    type="text"
                    id="canonicalUrl"
                    class="field-input"
                    placeholder="https://calmiqs.com/blog/post-slug"
                  />
                </div>
              </div>

              <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-lg font-bold text-primary mb-4">‚ôø Accessibility (A11y)</h2>
                <label class="flex items-center gap-2 text-sm cursor-pointer mb-3">
                  <input type="checkbox" id="hasImageAlt" checked class="w-4 h-4 accent-primary" />
                  <span>All images have alt text</span>
                </label>
                <label class="flex items-center gap-2 text-sm cursor-pointer mb-3">
                  <input
                    type="checkbox"
                    id="hasHeadingHierarchy"
                    checked
                    class="w-4 h-4 accent-primary"
                  />
                  <span>Proper heading hierarchy</span>
                </label>
                <label class="flex items-center gap-2 text-sm cursor-pointer">
                  <input type="checkbox" id="hasSkipLink" checked class="w-4 h-4 accent-primary" />
                  <span>Skip link present</span>
                </label>
              </div>
            </div>

            <div class="space-y-6">
              <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-lg font-bold text-primary mb-4">üìã JSON Schema</h2>
                <div class="field-group">
                  <label class="field-label">Schema Type</label>
                  <select id="schemaType" class="field-input">
                    <option value="Article">Article</option>
                    <option value="BlogPosting">Blog Post</option>
                    <option value="NewsArticle">News Article</option>
                  </select>
                </div>
                <button
                  id="generateSchemaBtn"
                  class="btn-primary w-full mb-4 flex items-center justify-center gap-2"
                >
                  <i class="fas fa-magic"></i>
                  Generate Schema
                </button>
                <div class="schema-preview" id="schemaPreview">{ Ready to generate }</div>
                <button
                  id="copySchemaBtn"
                  class="btn-secondary w-full mt-3 flex items-center justify-center gap-2"
                >
                  <i class="fas fa-copy"></i>
                  Copy
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- SETTINGS TAB -->
        <div id="settings" class="tab-content fade-in">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-white rounded-xl shadow p-6">
              <h2 class="text-lg font-bold text-primary mb-4">üîê Site Configuration</h2>
              <div class="field-group">
                <label class="field-label">Site URL</label>
                <input
                  type="text"
                  id="siteUrl"
                  class="field-input"
                  value="https://calmiqs.pages.dev"
                />
              </div>
              <div class="field-group">
                <label class="field-label">Site Title</label>
                <input
                  type="text"
                  id="siteTitle"
                  class="field-input"
                  value="Calmiqs ‚Äì Wellness & Eco Balance"
                />
              </div>
              <div class="field-group">
                <label class="field-label">Site Description</label>
                <textarea id="siteDescription" class="field-input" rows="3">
Explore AI-powered wellness tools and eco-friendly insights</textarea
                >
              </div>
              <button
                id="saveSiteSettings"
                class="btn-primary w-full flex items-center justify-center gap-2"
              >
                <i class="fas fa-save"></i>
                Save Settings
              </button>
            </div>

            <div class="bg-white rounded-xl shadow p-6">
              <h2 class="text-lg font-bold text-primary mb-4">üóëÔ∏è Danger Zone</h2>
              <p class="text-sm text-gray-600 mb-4">These actions cannot be undone.</p>
              <button
                id="clearCacheBtn"
                class="btn-secondary w-full mb-3 flex items-center justify-center gap-2"
              >
                <i class="fas fa-broom"></i>
                Clear Cache
              </button>
              <button
                id="exportDataBtn"
                class="btn-secondary w-full mb-3 flex items-center justify-center gap-2"
              >
                <i class="fas fa-download"></i>
                Export Data
              </button>
              <button
                id="resetAdminBtn"
                class="btn-danger w-full flex items-center justify-center gap-2"
              >
                <i class="fas fa-exclamation-triangle"></i>
                Reset Password
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Image Library Modal -->
    <div id="imageLibraryModal" class="modal-overlay modal-hidden">
      <div class="modal-card">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-primary">üìö Image Library</h3>
          <button
            id="closeLibraryModal"
            type="button"
            class="text-2xl text-gray-400 hover:text-gray-600 p-0 border-0 bg-none cursor-pointer"
          >
            ‚úï
          </button>
        </div>
        <div
          class="grid grid-cols-2 md:grid-cols-4 gap-4 max-h-96 overflow-y-auto"
          id="libraryGridModal"
        >
          <div class="col-span-full text-center py-8 text-gray-500">Loading library...</div>
        </div>
      </div>
    </div>

    <!-- Hero Image Library Modal -->
    <div id="heroLibraryModal" class="modal-overlay modal-hidden">
      <div class="modal-card">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-primary">üìö Hero Image Library</h3>
          <button
            id="closeHeroLibraryModal"
            type="button"
            class="text-2xl text-gray-400 hover:text-gray-600 p-0 border-0 bg-none cursor-pointer"
          >
            ‚úï
          </button>
        </div>
        <div
          class="grid grid-cols-2 md:grid-cols-4 gap-4 max-h-96 overflow-y-auto"
          id="heroLibraryGrid"
        >
          <div class="col-span-full text-center py-8 text-gray-500">Loading library...</div>
        </div>
      </div>
    </div>

    <!-- Post Library Modal -->
    <div id="postLibraryModal" class="modal-overlay modal-hidden">
      <div class="modal-card">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-primary">üìö Posts Library</h3>
          <button
            id="closePostLibraryModal"
            type="button"
            class="text-2xl text-gray-400 hover:text-gray-600 p-0 border-0 bg-none cursor-pointer"
          >
            ‚úï
          </button>
        </div>
        <div class="max-h-96 overflow-y-auto" id="postLibraryList">
          <div class="text-center py-8 text-gray-500">Loading posts...</div>
        </div>
      </div>
    </div>

    <script>
      // ==== CONFIG ====
      const ADMIN_PASSWORD = "Hadia@2017";
      const WORKER_BASE = "/api";
      const ADMIN_TOKEN = "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Hadia@2017_Ayesha@2007";

      // ==== STATE ====
      let isAuthenticated = false;
      let currentPost = null;
      let allPosts = {};
      let autosaveTimer = null;
      let selectedHeroImage = null;

      // ==== AUTH ====
      document.getElementById("authForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const pwd = document.getElementById("authPassword").value;
        if (pwd === ADMIN_PASSWORD) {
          isAuthenticated = true;
          localStorage.setItem("calmiqsAuth", "true");
          sessionStorage.setItem("calmiqsAuth", "true");
          localStorage.setItem("isAdmin", "true");
          sessionStorage.setItem("isAdmin", "true");
          document.getElementById("authScreen").classList.add("hidden");
          document.getElementById("adminPanel").classList.remove("hidden");
          initializeEditor();
        } else {
          alert("‚ùå Incorrect password");
          document.getElementById("authPassword").value = "";
        }
      });

      document.getElementById("logoutBtn").addEventListener("click", () => {
        isAuthenticated = false;
        localStorage.removeItem("calmiqsAuth");
        sessionStorage.removeItem("calmiqsAuth");
        localStorage.removeItem("isAdmin");
        sessionStorage.removeItem("isAdmin");
        location.reload();
      });

      // ==== TAB NAVIGATION ====
      document.querySelectorAll(".tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const tabName = btn.dataset.tab;
          document.querySelectorAll(".tab-content").forEach((el) => el.classList.remove("active"));
          document.querySelectorAll(".tab-btn").forEach((el) => {
            el.classList.remove("border-primary", "text-primary");
            el.classList.add("border-transparent", "text-gray-600");
          });
          document.getElementById(tabName).classList.add("active");
          btn.classList.remove("border-transparent", "text-gray-600");
          btn.classList.add("border-primary", "text-primary");

          // Load data for specific tabs
          if (tabName === "images") loadImageLibraryTab();
          if (tabName === "newsletter") {
            loadNewsletterStats();
            loadSubscribers();
          }
        });
      });

      // ==== EDITOR TOOLBAR ====
      document.querySelectorAll(".editor-toolbar button").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          e.preventDefault();
          const cmd = btn.dataset.cmd;
          if (cmd === "link") {
            const url = prompt("Enter URL:");
            if (url) document.execCommand("createLink", false, url);
          } else if (["h2", "h3", "ul", "ol"].includes(cmd)) {
            if (cmd === "ul") document.execCommand("insertUnorderedList", false, null);
            else if (cmd === "ol") document.execCommand("insertOrderedList", false, null);
            else document.execCommand("formatBlock", false, `<${cmd}>`);
          } else {
            document.execCommand(cmd, false, null);
          }
          updatePreview();
          document.getElementById("postContent").focus();
        });
      });

      // ==== POST MANAGEMENT ====
      async function authFetch(url, opts = {}) {
        opts.headers = opts.headers || {};
        opts.headers["X-Admin-Token"] = ADMIN_TOKEN;
        return fetch(url, opts);
      }

      function generateSlug(title) {
        return title
          .toLowerCase()
          .replace(/[^a-z0-9]+/g, "-")
          .replace(/(^-|-$)/g, "");
      }

      function updatePreview() {
        const title = document.getElementById("postTitle").value || "Untitled";
        const content = document.getElementById("postContent").innerHTML || "<p>No content</p>";
        const preview = document.getElementById("postPreview");
        preview.innerHTML = `<h3 class="font-bold text-primary mb-2">${title}</h3><div class="text-xs">${content.substring(
          0,
          300
        )}...</div>`;
      }

      document.getElementById("postTitle").addEventListener("input", () => {
        const slug = generateSlug(document.getElementById("postTitle").value);
        document.getElementById("postSlug").value = slug;
        updatePreview();
      });

      document.getElementById("postContent").addEventListener("input", updatePreview);

      document.getElementById("newPostBtn").addEventListener("click", () => {
        document.getElementById("postTitle").value = "";
        document.getElementById("postSlug").value = "";
        document.getElementById("postExcerpt").value = "";
        document.getElementById("postDate").value = new Date().toISOString().split("T")[0];
        document.getElementById("postContent").innerHTML = "";
        document.getElementById("postCategory").value = "wellness";
        document.getElementById("postTags").value = "";
        document.getElementById("postAuthor").value = "Calmiqs Team";
        document.getElementById("postReadTime").value = "";
        document.getElementById("metaDescription").value = "";
        document.getElementById("metaKeywords").value = "";
        document.getElementById("canonicalUrl").value = "";
        document.getElementById("heroImageFile").value = "";
        document.getElementById("heroAlt").value = "";
        document.getElementById("heroPreview").innerHTML = "";
        selectedHeroImage = null;
        currentPost = null;
        updatePreview();
      });

      // Save post handler
      document.getElementById("savePostBtn").addEventListener("click", async () => {
        const title = document.getElementById("postTitle").value.trim();
        if (!title) {
          alert("Please enter a post title");
          return;
        }

        // Generate slug from title
        const slug = title
          .toLowerCase()
          .replace(/[^\w\s-]/g, "")
          .replace(/\s+/g, "-")
          .replace(/-+/g, "-")
          .trim();

        const postData = {
          slug,
          title,
          content: document.getElementById("postContent").innerHTML,
          excerpt: document.getElementById("postExcerpt").value.trim(),
          image: document.getElementById("postImage").value.trim(),
          imageAlt: document.getElementById("heroAlt").value.trim(),
          category: document.getElementById("postCategory").value,
          tags: document
            .getElementById("postTags")
            .value.split(",")
            .map((t) => t.trim())
            .filter((t) => t),
          author: document.getElementById("postAuthor").value || "Calmiqs Team",
          date: document.getElementById("postDate").value || new Date().toISOString().split("T")[0],
        };

        const saveBtn = document.getElementById("savePostBtn");
        saveBtn.disabled = true;
        saveBtn.textContent = "üíæ Saving...";

        try {
          const response = await fetch("/api/admin/posts", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-Admin-Token": "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Hadia@2017_Ayesha@2007",
            },
            body: JSON.stringify(postData),
          });

          const result = await response.json();

          if (response.ok) {
            alert("‚úÖ Post saved successfully!\nSlug: " + result.slug);
            document.getElementById("postSlug").value = result.slug;
          } else {
            alert("‚ùå Save failed: " + (result.error || "Unknown error"));
          }
        } catch (error) {
          console.error("Save error:", error);
          alert("‚ùå Save failed: " + error.message);
        } finally {
          saveBtn.disabled = false;
          saveBtn.textContent = "üíæ Save Post";
        }
      });

      document.getElementById("loadPostBtn").addEventListener("click", () => {
        document.getElementById("postLibraryModal").classList.remove("modal-hidden");
        loadPostLibrary();
      });

      async function loadPostLibrary() {
        try {
          const res = await authFetch(`${WORKER_BASE}/api/posts`);
          const data = await res.json();
          const list = document.getElementById("postLibraryList");
          list.innerHTML = "";

          if (!data.posts || data.posts.length === 0) {
            list.innerHTML = "<p class='text-center text-gray-500 py-8'>No posts yet</p>";
            return;
          }

          data.posts.forEach((post) => {
            const el = document.createElement("div");
            el.className = "p-4 border-b hover:bg-gray-50 cursor-pointer transition";
            el.innerHTML = `
              <div class="font-semibold text-primary">${post.title}</div>
              <div class="text-xs text-gray-500">${post.slug} ‚Ä¢ ${new Date(
              post.date
            ).toLocaleDateString()}</div>
            `;
            el.addEventListener("click", async () => {
              try {
                const fullRes = await authFetch(`${WORKER_BASE}/api/posts/${post.slug}`);
                const fullPost = await fullRes.json();
                loadPostToEditor(fullPost);
                document.getElementById("postLibraryModal").classList.add("modal-hidden");
              } catch (err) {
                alert("‚ùå Failed to load post");
              }
            });
            list.appendChild(el);
          });
        } catch (err) {
          console.error(err);
          document.getElementById("postLibraryList").innerHTML =
            "<p class='text-center text-red-600 py-8'>Failed to load posts</p>";
        }
      }

      function loadPostToEditor(post) {
        document.getElementById("postTitle").value = post.title;
        document.getElementById("postExcerpt").value = post.excerpt;
        document.getElementById("postDate").value = post.date;
        document.getElementById("postContent").innerHTML = post.content;
        document.getElementById("postCategory").value = post.category;
        document.getElementById("postTags").value = (post.tags || []).join(", ");
        document.getElementById("postAuthor").value = post.author || "";
        document.getElementById("postReadTime").value = post.readTime || "";
        document.getElementById("metaDescription").value = post.metaDescription || "";
        document.getElementById("metaKeywords").value = post.metaKeywords || "";
        document.getElementById("canonicalUrl").value = post.canonicalUrl || "";
        document.getElementById("heroAlt").value = post.imageAlt || "";
        document.getElementById("postSlug").value = post.slug;
        selectedHeroImage = post.image;
        if (post.image) {
          document.getElementById(
            "heroPreview"
          ).innerHTML = `<div class="image-preview"><img src="${post.image}" alt="${post.imageAlt}" /></div>`;
        }
        currentPost = post;
        updatePreview();
      }

      document.getElementById("deletePostBtn").addEventListener("click", async () => {
        const slug = document.getElementById("postSlug").value;
        if (!slug) return alert("No post selected");
        if (!confirm("Delete this post? This cannot be undone.")) return;

        try {
          const res = await authFetch(`${WORKER_BASE}/api/posts/${slug}`, { method: "DELETE" });
          if (res.ok) {
            alert("‚úÖ Post deleted");
            document.getElementById("newPostBtn").click();
          } else {
            alert("‚ùå Delete failed");
          }
        } catch (err) {
          alert("‚ùå Error: " + err.message);
        }
      });

      // ==== IMAGE UPLOAD ====
      document.getElementById("uploadHeroBtn").addEventListener("click", async () => {
        const file = document.getElementById("heroImageFile").files[0];
        if (!file) return alert("Choose an image");

        const form = new FormData();
        form.append("file", file);
        form.append("alt", document.getElementById("heroAlt").value || file.name);

        try {
          document.getElementById("uploadHeroBtn").disabled = true;
          const res = await authFetch(`${WORKER_BASE}/upload`, { method: "POST", body: form });
          const data = await res.json();
          if (res.ok) {
            const url = data.url || `${WORKER_BASE}/files/${encodeURIComponent(data.r2Key)}`;
            selectedHeroImage = url;
            document.getElementById(
              "heroPreview"
            ).innerHTML = `<div class="image-preview"><img src="${url}" alt="${
              data.alt || "Hero image"
            }" /></div>`;
            alert("‚úÖ Hero image uploaded");
          } else {
            alert("‚ùå Upload failed: " + (data.error || "Unknown error"));
          }
        } catch (err) {
          alert("‚ùå Upload failed: " + err.message);
        } finally {
          document.getElementById("uploadHeroBtn").disabled = false;
        }
      });

      document.getElementById("selectHeroBtn").addEventListener("click", () => {
        document.getElementById("heroLibraryModal").classList.remove("modal-hidden");
        loadHeroImageLibrary();
      });

      async function loadHeroImageLibrary() {
        try {
          const res = await authFetch(`${WORKER_BASE}/list`);
          const data = await res.json();
          const grid = document.getElementById("heroLibraryGrid");
          grid.innerHTML = "";

          if (!data.images || data.images.length === 0) {
            grid.innerHTML =
              "<div class='col-span-full text-center text-gray-500 py-8'>No images in library</div>";
            return;
          }

          data.images.forEach((img) => {
            const thumb = document.createElement("div");
            thumb.className = "relative group cursor-pointer";
            const thumbImg = document.createElement("img");
            thumbImg.src = `${WORKER_BASE}/files/${encodeURIComponent(img.r2Key || img.key)}`;
            thumbImg.className = "w-full h-32 object-cover rounded hover:opacity-75 transition";
            thumbImg.alt = img.alt || "";

            thumbImg.addEventListener("click", () => {
              selectedHeroImage = thumbImg.src;
              document.getElementById(
                "heroPreview"
              ).innerHTML = `<div class="image-preview"><img src="${selectedHeroImage}" alt="${
                img.alt || "Hero"
              }" /></div>`;
              document.getElementById("heroAlt").value = img.alt || "";
              document.getElementById("heroLibraryModal").classList.add("modal-hidden");
              alert("‚úÖ Hero image selected");
            });

            thumb.appendChild(thumbImg);
            grid.appendChild(thumb);
          });
        } catch (err) {
          console.error(err);
          document.getElementById("heroLibraryGrid").innerHTML =
            "<div class='col-span-full text-center text-red-600 py-8'>Failed to load library</div>";
        }
      }

      document.getElementById("uploadInlineBtn").addEventListener("click", async () => {
        const file = document.getElementById("inlineImageFile").files[0];
        if (!file) return alert("Choose an image");

        const form = new FormData();
        form.append("file", file);

        try {
          document.getElementById("uploadInlineBtn").disabled = true;
          const res = await authFetch(`${WORKER_BASE}/upload`, { method: "POST", body: form });
          const data = await res.json();
          if (res.ok) {
            const url = data.url || `${WORKER_BASE}/files/${encodeURIComponent(data.r2Key)}`;
            const img = document.createElement("img");
            img.src = url;
            img.className = "inline-img my-4 rounded-lg shadow-md max-w-full";
            img.alt = file.name;
            img.style.maxWidth = "100%";
            img.style.height = "auto";
            document.getElementById("postContent").appendChild(img);
            document.getElementById("inlineImageFile").value = "";
            alert("‚úÖ Image inserted");
            updatePreview();
          } else {
            alert("‚ùå Upload failed: " + (data.error || "Unknown error"));
          }
        } catch (err) {
          alert("‚ùå Upload failed: " + err.message);
        } finally {
          document.getElementById("uploadInlineBtn").disabled = false;
        }
      });

      document.getElementById("openLibraryBtn").addEventListener("click", () => {
        document.getElementById("imageLibraryModal").classList.remove("modal-hidden");
        loadInlineImageLibrary();
      });

      async function loadInlineImageLibrary() {
        try {
          const res = await authFetch(`${WORKER_BASE}/list`);
          const data = await res.json();
          const grid = document.getElementById("libraryGridModal");
          grid.innerHTML = "";

          if (!data.images || data.images.length === 0) {
            grid.innerHTML =
              "<div class='col-span-full text-center text-gray-500 py-8'>No images in library</div>";
            return;
          }

          data.images.forEach((img) => {
            const thumb = document.createElement("img");
            thumb.src = `${WORKER_BASE}/files/${encodeURIComponent(img.r2Key || img.key)}`;
            thumb.className =
              "w-full h-32 object-cover rounded cursor-pointer hover:opacity-75 transition";
            thumb.alt = img.alt || "";

            thumb.addEventListener("click", () => {
              const inlineImg = document.createElement("img");
              inlineImg.src = thumb.src;
              inlineImg.className = "inline-img my-4 rounded-lg shadow-md max-w-full";
              inlineImg.alt = img.alt || "";
              inlineImg.style.maxWidth = "100%";
              inlineImg.style.height = "auto";
              document.getElementById("postContent").appendChild(inlineImg);
              document.getElementById("imageLibraryModal").classList.add("modal-hidden");
              updatePreview();
            });
            grid.appendChild(thumb);
          });
        } catch (err) {
          console.error(err);
          document.getElementById("libraryGridModal").innerHTML =
            "<div class='col-span-full text-center text-red-600 py-8'>Failed to load library</div>";
        }
      }

      async function loadImageLibraryTab() {
        try {
          const res = await authFetch(`${WORKER_BASE}/list`);
          const data = await res.json();
          const grid = document.getElementById("imageLibraryGrid");
          grid.innerHTML = "";

          if (!data.images || data.images.length === 0) {
            grid.innerHTML =
              "<div class='col-span-full text-center text-gray-500 py-8'>No images uploaded yet</div>";
            return;
          }

          data.images.forEach((img) => {
            const card = document.createElement("div");
            card.className =
              "bg-white rounded-lg overflow-hidden shadow hover:shadow-lg transition";
            const imgSrc = `${WORKER_BASE}/files/${encodeURIComponent(img.r2Key || img.key)}`;
            card.innerHTML = `
              <img src="${imgSrc}" alt="${img.alt || ""}" class="w-full h-40 object-cover" />
              <div class="p-3">
                <p class="text-sm font-medium text-gray-700 truncate">${
                  img.title || img.filename || "Image"
                }</p>
                <p class="text-xs text-gray-500">${img.alt || "No alt text"}</p>
              </div>
            `;
            grid.appendChild(card);
          });
        } catch (err) {
          console.error(err);
          document.getElementById("imageLibraryGrid").innerHTML =
            "<div class='col-span-full text-center text-red-600 py-8'>Failed to load images</div>";
        }
      }

      // ==== MODAL CLOSE HANDLERS ====
      document.getElementById("closeLibraryModal").addEventListener("click", () => {
        document.getElementById("imageLibraryModal").classList.add("modal-hidden");
      });

      document.getElementById("closeHeroLibraryModal").addEventListener("click", () => {
        document.getElementById("heroLibraryModal").classList.add("modal-hidden");
      });

      document.getElementById("closePostLibraryModal").addEventListener("click", () => {
        document.getElementById("postLibraryModal").classList.add("modal-hidden");
      });

      // Close modals on outside click
      document.querySelectorAll(".modal-overlay").forEach((modal) => {
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            modal.classList.add("modal-hidden");
          }
        });
      });

      // ==== NEWSLETTER ====
      async function loadNewsletterStats() {
        try {
          const res = await authFetch(`${WORKER_BASE}/api/newsletter/stats`);
          const stats = await res.json();
          document.getElementById("totalSubscribers").textContent = stats.total || 0;
          document.getElementById("activeSubscribers").textContent = stats.active || 0;
          document.getElementById("unsubscribed").textContent = stats.unsubscribed || 0;
        } catch (err) {
          console.error("Failed to load newsletter stats:", err);
        }
      }

      async function loadSubscribers() {
        try {
          const res = await authFetch(`${WORKER_BASE}/api/newsletter/subscribers`);
          const data = await res.json();
          const tbody = document.getElementById("subscribersList");
          tbody.innerHTML = "";

          if (!data.subscribers || data.subscribers.length === 0) {
            tbody.innerHTML =
              "<tr><td colspan='4' class='px-4 py-8 text-center text-gray-500'>No subscribers yet</td></tr>";
            return;
          }

          data.subscribers.forEach((sub) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td class="px-4 py-2">${sub.email}</td>
              <td class="px-4 py-2"><span class="status-badge ${
                sub.status === "active" ? "status-success" : "status-warning"
              }">${sub.status}</span></td>
              <td class="px-4 py-2 text-xs">${new Date(sub.subscribedAt).toLocaleDateString()}</td>
              <td class="px-4 py-2 text-center">
                <button type="button" class="text-red-600 hover:text-red-800 text-sm" onclick="unsubscribeEmail('${
                  sub.email
                }')">Remove</button>
              </td>
            `;
            tbody.appendChild(row);
          });
        } catch (err) {
          console.error("Failed to load subscribers:", err);
        }
      }

      window.unsubscribeEmail = async (email) => {
        if (!confirm(`Unsubscribe ${email}?`)) return;
        try {
          await authFetch(`${WORKER_BASE}/api/newsletter/unsubscribe`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email }),
          });
          alert("‚úÖ Unsubscribed");
          loadSubscribers();
          loadNewsletterStats();
        } catch (err) {
          alert("‚ùå Error: " + err.message);
        }
      };

      document.getElementById("sendNewsletterBtn").addEventListener("click", async () => {
        const subject = document.getElementById("newsletterSubject").value.trim();
        const content = document.getElementById("newsletterContent").value.trim();

        if (!subject || !content) return alert("Fill in subject and content");

        try {
          const res = await authFetch(`${WORKER_BASE}/api/newsletter/send`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              subject,
              content,
              fromEmail: document.getElementById("fromEmail").value,
              fromName: document.getElementById("fromName").value,
            }),
          });
          if (res.ok) {
            alert("‚úÖ Newsletter sent!");
            document.getElementById("newsletterSubject").value = "";
            document.getElementById("newsletterContent").value = "";
          } else {
            alert("‚ùå Send failed");
          }
        } catch (err) {
          alert("‚ùå Error: " + err.message);
        }
      });

      // ==== SEO & SCHEMA ====
      document.getElementById("metaDescription").addEventListener("input", (e) => {
        document.getElementById("metaDescCount").textContent = `${e.target.value.length}/160`;
      });

      document.getElementById("generateSchemaBtn").addEventListener("click", () => {
        const schemaType = document.getElementById("schemaType").value;
        const title = document.getElementById("postTitle").value || "Untitled";
        const excerpt = document.getElementById("postExcerpt").value || "";
        const author = document.getElementById("postAuthor").value || "Calmiqs Team";
        const date = document.getElementById("postDate").value || new Date().toISOString();

        const schema = {
          "@context": "https://schema.org",
          "@type": schemaType,
          headline: title,
          description: excerpt,
          author: { "@type": "Person", name: author },
          datePublished: date,
          image:
            document.getElementById("ogImage").value ||
            selectedHeroImage ||
            "https://calmiqs.pages.dev/assets/logo.svg",
          publisher: {
            "@type": "Organization",
            name: "Calmiqs",
            logo: "https://calmiqs.pages.dev/assets/logo.svg",
          },
        };

        document.getElementById("schemaPreview").textContent = JSON.stringify(schema, null, 2);
      });

      document.getElementById("copySchemaBtn").addEventListener("click", () => {
        const schema = document.getElementById("schemaPreview").textContent;
        navigator.clipboard
          .writeText(schema)
          .then(() => {
            alert("‚úÖ Schema copied to clipboard");
          })
          .catch(() => {
            alert("Failed to copy");
          });
      });

      document.getElementById("saveSiteSettings").addEventListener("click", () => {
        const settings = {
          siteUrl: document.getElementById("siteUrl").value,
          siteTitle: document.getElementById("siteTitle").value,
          siteDescription: document.getElementById("siteDescription").value,
        };
        localStorage.setItem("calmiqsSiteSettings", JSON.stringify(settings));
        alert("‚úÖ Settings saved");
      });

      // ==== AUTO-SAVE ====
      document.getElementById("autosaveToggle").addEventListener("change", (e) => {
        if (e.target.checked) startAutosave();
        else if (autosaveTimer) clearInterval(autosaveTimer);
      });

      function startAutosave() {
        autosaveTimer = setInterval(() => {
          if (document.getElementById("postTitle").value.trim()) {
            document.getElementById("savePostBtn").click();
          }
        }, 60000);
      }

      // ==== INITIALIZE ====
      function initializeEditor() {
        document.getElementById("postDate").valueAsDate = new Date();
        const settings = JSON.parse(localStorage.getItem("calmiqsSiteSettings") || "{}");
        if (settings.siteUrl) document.getElementById("siteUrl").value = settings.siteUrl;
        if (settings.siteTitle) document.getElementById("siteTitle").value = settings.siteTitle;
        if (settings.siteDescription)
          document.getElementById("siteDescription").value = settings.siteDescription;
        if (document.getElementById("autosaveToggle").checked) startAutosave();
      }

      // Check auth on load
      if (
        localStorage.getItem("calmiqsAuth") === "true" &&
        localStorage.getItem("isAdmin") === "true"
      ) {
        isAuthenticated = true;
        document.getElementById("authScreen").classList.add("hidden");
        document.getElementById("adminPanel").classList.remove("hidden");
        initializeEditor();
      }
    </script>
  </body>
</html>
